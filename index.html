
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Simon's Blog</title>
	<meta name="author" content="Simon Dickson">

	
	<meta name="description" content="Dec 3rd, 2013 fsharp, monad, owin Comments Owin: The Myth, the Monad I&rsquo;ve played with owin in F# before and recently have been playing with &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Simon's Blog" type="application/atom+xml">
	
	<link rel="canonical" href="http://simonhdickson.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-46304436-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
	
</div>
<hgroup>
  <h1><a href="/">Simon's Blog</a></h1>
  
    <h2>Move along please</h2>
  
</hgroup>

<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
<nav id="sub-nav">
	<div class="social">
		
		
		
		
			<a class="twitter" href="http://twitter.com/simonhdickson" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/simonhdickson" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-12-03T20:37:00+00:00" data-updated="true" itemprop="datePublished">Dec 3<span>rd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/fsharp/'>fsharp</a>, <a class='category' href='/blog/categories/monad/'>monad</a>, <a class='category' href='/blog/categories/owin/'>owin</a>


</div>
		
			<span class="comments"><a href="/blog/2013/12/03/owin-the-myth/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/12/03/owin-the-myth/" itemprop="url">Owin: The Myth, the Monad</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>I&rsquo;ve played with owin in F# <a href="https://github.com/simonhdickson/Bar">before</a> and recently have been playing with computational builders. So I thought the other day, how about combining them both so you can write something long the lines of this:</p>

<figure class='code'><figcaption><span>Owin Monad</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">pipeline</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">owin</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">get</span> <span class="s2">&quot;/&quot;</span> <span class="o">&lt;@</span> <span class="k">fun</span> <span class="bp">()</span> <span class="o">-&gt;</span> <span class="s2">&quot;Hello World&quot;</span> <span class="o">@&gt;</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Gotta love that syntactic sugar, so how do we do this? Well really, the owin monad is actually really simple to implement. You have a state, in this case the state is the is the IAppBuilder. So for posterity let&rsquo;s just steal the important bits of the state monad from FSharpx and use that. So let&rsquo;s skip to the good bit:</p>

<figure class='code'><figcaption><span>OwinBuilder</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'> <span class="k">type</span> <span class="nc">OwinBuilder</span><span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>    <span class="c1">// omitted</span>
</span><span class='line'>    <span class="o">[&lt;</span><span class="nc">CustomOperation</span><span class="o">(</span><span class="s2">&quot;get&quot;</span><span class="o">,</span> <span class="nc">MaintainsVariableSpaceUsingBind</span><span class="o">=</span><span class="bp">true</span><span class="o">)&gt;]</span>
</span><span class='line'>    <span class="k">member</span> <span class="n">this</span><span class="o">.</span><span class="nc">Get</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">url</span><span class="o">,</span> <span class="n">processor</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>        <span class="n">this</span><span class="o">.</span><span class="nc">Bind</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="k">fun</span> <span class="n">a</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="n">this</span><span class="o">.</span><span class="nc">Bind</span><span class="o">(</span><span class="n">getState</span><span class="o">,</span> <span class="k">fun</span> <span class="o">(</span><span class="n">app</span><span class="o">:</span><span class="nc">IAppBuilder</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span class='line'>                <span class="n">putState</span> <span class="o">&lt;|</span> <span class="n">app</span><span class="o">.</span><span class="nc">UseRequestProcessor</span><span class="o">(</span><span class="s2">&quot;GET&quot;</span><span class="o">,</span> <span class="n">url</span><span class="o">,</span> <span class="n">processor</span><span class="o">)))</span>
</span></code></pre></td></tr></table></div></figure>


<p>In a computation expression there is a <a href="http://msdn.microsoft.com/en-us/library/dd233182.aspx">standard workflow</a> for operations that you can use (this includes the Bind operation). In our case we don&rsquo;t actually want this, we want to define our own operators (for get, post, etc). The CustomOperation attribute allows you to define a these, and also describe how your custom operator works.</p>

<p>In this case we want to define our operator so that each line defines a new endpoint of our web api, and pass all the state around in the background. To do this the &ldquo;MaintainsVariableSpaceUsingBind&rdquo;, works to bind all the statements together. In the above code any previous operators will be passed in the m paramter, and then the we&rsquo;re basically appending our new owin endpoint to end of that, which will then be passed into the next operator, etc.</p>

<p>Anyway, here is a <a href="https://github.com/simonhdickson/OwinBuilder">link to the repository</a>, if you&rsquo;re interested in looking into it further.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-24T22:05:00+00:00" data-updated="true" itemprop="datePublished">Nov 24<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/fsharp/'>fsharp</a>, <a class='category' href='/blog/categories/holy-wars/'>holy wars</a>, <a class='category' href='/blog/categories/programming/'>programming</a>


</div>
		
			<span class="comments"><a href="/blog/2013/11/24/tabs-vs-spaces/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/24/tabs-vs-spaces/" itemprop="url">Tabs vs Spaces</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>Spaces, the final frontier</h3>

<p>Tabs vs Spaces: the greatest of all the holy wars. Well it turns out that in F# there is no need for that debate: because in F# tabs are treated as an error by the compiler.</p>

<figure class='code'><figcaption><span>Tabs treated as error</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">spaceFun</span> <span class="n">x</span> <span class="o">=</span>
</span><span class='line'>  <span class="n">x</span> <span class="c1">// ok</span>
</span><span class='line'>
</span><span class='line'><span class="k">let</span> <span class="n">tabFun</span> <span class="n">x</span> <span class="o">=</span>
</span><span class='line'>  <span class="n">x</span> <span class="c1">// error!</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now if only there was an option for the F# compiler to treat nulls as errors too&hellip;</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-22T15:56:00+00:00" data-updated="true" itemprop="datePublished">Nov 22<span>nd</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/fsharp/'>fsharp</a>, <a class='category' href='/blog/categories/functional/'>functional</a>, <a class='category' href='/blog/categories/monad/'>monad</a>


</div>
		
			<span class="comments"><a href="/blog/2013/11/22/the-simon-says-monad/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/22/the-simon-says-monad/" itemprop="url">The Simon Says Monad</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h3>What is a Monad?</h3>

<p>Everyone tries to explain monads in a simple way and makes it sound way more complicated than it really is. Something is monadic if there are rule or set of rules that can define how a set of functions is combined into another function. That not strictly mathmatically true, but anything that fits that description could at least be described as monadic.</p>

<p>You might be reading that and thinking &ldquo;surely everything is monadic?&rdquo;, well yes, almost everything is kind of monadic (or can be described in that way).</p>

<h3>The Simon Says Monad</h3>

<p>May I present the single most useful monad in the world!</p>

<figure class='code'><figcaption><span>Simon Says</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">doIt</span> <span class="n">this</span> <span class="n">that</span> <span class="o">=</span>
</span><span class='line'>    <span class="n">simonSays</span><span class="o">{</span>
</span><span class='line'>        <span class="k">let</span><span class="o">!</span> <span class="n">i</span> <span class="o">=</span> <span class="n">this</span>
</span><span class='line'>        <span class="k">let</span><span class="o">!</span> <span class="n">j</span> <span class="o">=</span> <span class="n">that</span>
</span><span class='line'>        <span class="n">printfn</span> <span class="s2">&quot;%i&quot;</span> <span class="o">&lt;|</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
</span><span class='line'>    <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, the way I see it, when you declare simonSays { &hellip; }; you&rsquo;re basically saying &ldquo;we don&rsquo;t play by normal rules: now we play by simonSays rules.&rdquo; What this means is, if you don&rsquo;t say &ldquo;Simon Says&rdquo;, then you don&rsquo;t do anything. So for example, if we invoke it like this:</p>

<figure class='code'><figcaption><span>Simon Says 1 + 1</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="n">doIt</span> <span class="o">(</span><span class="nc">SimonSays</span> <span class="mi">1</span><span class="o">)</span> <span class="o">(</span><span class="nc">SimonSays</span> <span class="mi">1</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then the result is SimonSays 2. However if we do:</p>

<figure class='code'><figcaption><span>Simon Says 1 + SimonDidntSay</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="n">doIt</span> <span class="o">(</span><span class="nc">SimonSays</span> <span class="mi">1</span><span class="o">)</span> <span class="nc">SimonDidntSay</span>
</span></code></pre></td></tr></table></div></figure>


<p>The the result is SimonDidntSay. To go back to the definition of monads earlier, &ldquo;Something is monadic if there are rule or set of rules that can define how a set of functions is combined into another function&rdquo;. In the Simon Says monad, there is a single very simple rule: you must say &ldquo;Simon Says&rdquo;, otherwise we don&rsquo;t do anything. If we re-write this code slightly to remove all the F# sugar, it become far more obvious what is happening here.</p>

<figure class='code'><figcaption><span>Simon Says using matches</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">doIt</span> <span class="n">this</span> <span class="n">that</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">match</span> <span class="n">this</span> <span class="k">with</span>
</span><span class='line'>    <span class="o">|</span> <span class="nc">SimonSays</span> <span class="n">i</span> <span class="o">-&gt;</span>
</span><span class='line'>        <span class="k">match</span> <span class="n">that</span> <span class="k">with</span>
</span><span class='line'>        <span class="o">|</span> <span class="nc">SimonSays</span> <span class="n">j</span> <span class="o">-&gt;</span> <span class="n">printfn</span> <span class="s2">&quot;%i&quot;</span> <span class="o">&lt;|</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
</span><span class='line'>        <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="bp">()</span>
</span><span class='line'>    <span class="o">|</span> <span class="o">_</span> <span class="o">-&gt;</span> <span class="bp">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you build up a large chain of these things, then writing all this would get cumbersome.</p>

<h3>Maybe monad</h3>

<p>If you know your monads, you may have already noticed that the &ldquo;Simon Says&rdquo; monad bears a slightly resemblance to the &ldquo;Maybe&rdquo; monad. Ok, it IS actually maybe monad. Infact you can find more information about the maybe monad <a href="http://en.wikibooks.org/wiki/F_Sharp_Programming/Computation_Expressions">here</a>.</p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2013-11-16T15:33:00+00:00" data-updated="true" itemprop="datePublished">Nov 16<span>th</span>, 2013</time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/fscheck/'>fscheck</a>, <a class='category' href='/blog/categories/fsharp/'>fsharp</a>, <a class='category' href='/blog/categories/testing/'>testing</a>


</div>
		
			<span class="comments"><a href="/blog/2013/11/16/fscheck/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2013/11/16/fscheck/" itemprop="url">FsCheck</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<h2>Property based testing</h2>

<p>So you might be first wondering what property based testing means. Simply put you describe properties of your functions, and then you bombard your code with data trying to prove or disprove these properties.</p>

<p>Here&rsquo;s an example, let&rsquo;s say we have a function like this:</p>

<figure class='code'><figcaption><span>Remove Negatives Function</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">removeNegatives</span> <span class="kt">list</span> <span class="o">=</span>
</span><span class='line'>        <span class="k">let</span> <span class="k">rec</span> <span class="n">removeNegatives&#39;</span> <span class="kt">list</span> <span class="n">newList</span> <span class="o">=</span>
</span><span class='line'>            <span class="k">match</span> <span class="kt">list</span> <span class="k">with</span>
</span><span class='line'>            <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="n">newList</span>
</span><span class='line'>            <span class="o">|</span> <span class="n">head</span> <span class="o">::</span> <span class="n">tail</span> <span class="k">when</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">removeNegatives&#39;</span> <span class="n">tail</span> <span class="n">newList</span>
</span><span class='line'>            <span class="o">|</span> <span class="n">head</span> <span class="o">::</span> <span class="n">tail</span> <span class="o">-&gt;</span> <span class="n">removeNegatives&#39;</span> <span class="n">tail</span> <span class="o">(</span><span class="n">head</span> <span class="o">::</span> <span class="n">newList</span><span class="o">)</span>
</span><span class='line'>        <span class="n">removeNegatives&#39;</span> <span class="kt">list</span> <span class="bp">[]</span>
</span></code></pre></td></tr></table></div></figure>


<p>And we want to say this function has the following three properties:</p>

<ol>
<li>If you pass in a list, it returns the list without any negative numbers in it.</li>
<li>If you pass in a list without any negative numbers in it, you get exactly the same list back (this is implied from the first property, but let&rsquo;s make it explict anyway).</li>
<li>The function will not re-order the elements.</li>
</ol>


<p>So, how do we go about testing these properties?</p>

<h2>FsCheck to the rescue</h2>

<p>FsCheck is an F# port of the Haskell framework QuickCheck. What it&rsquo;ll let us do is fire a whole bunch of data at our function with the aim of helping us ensure that these properties hold.</p>

<p>Now before we get onto FsCheck itself, let&rsquo;s look at how we might test this traditionally. Normally using something like xUnit, you&rsquo;d have to write specific examples such as this:</p>

<figure class='code'><figcaption><span>Normal test </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="o">[&lt;</span><span class="nc">Fact</span><span class="o">&gt;]</span>
</span><span class='line'><span class="k">let</span> <span class="o">``</span><span class="k">for</span> <span class="n">a</span> <span class="n">non</span><span class="o">-</span><span class="n">negative</span> <span class="kt">list</span><span class="o">,</span> <span class="n">returns</span> <span class="n">the</span> <span class="n">same</span> <span class="kt">list</span><span class="o">``</span> <span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="kt">list</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="o">;</span><span class="mi">2</span><span class="o">;</span><span class="mi">3</span><span class="o">]</span>
</span><span class='line'>    <span class="k">let</span> <span class="n">result</span> <span class="o">=</span> <span class="kt">list</span> <span class="o">=</span> <span class="n">removeNegatives</span> <span class="kt">list</span>
</span><span class='line'>    <span class="nn">Assert</span><span class="p">.</span><span class="nc">True</span> <span class="n">result</span>
</span></code></pre></td></tr></table></div></figure>


<p>This does work, but it means you have to manually come up with a few examples of this, a few examples of the other ones. In this particular case the function is simple enough that this would find any bugs but in more complex functions there might be certain numbers that would break it.</p>

<p>So using FsCheck we would instead might define this test like this:</p>

<figure class='code'><figcaption><span>FsCheck test</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="o">[&lt;</span><span class="nc">Property</span><span class="o">&gt;]</span>
</span><span class='line'><span class="k">let</span> <span class="o">``</span><span class="k">for</span> <span class="n">a</span> <span class="n">non</span><span class="o">-</span><span class="n">negative</span> <span class="kt">list</span><span class="o">,</span> <span class="n">returns</span> <span class="n">the</span> <span class="n">same</span> <span class="kt">list</span><span class="o">``</span> <span class="o">(</span><span class="kt">list</span><span class="o">:</span><span class="nc">NonNegativeInt</span> <span class="kt">list</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="kt">list</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">i</span><span class="o">:</span><span class="nc">NonNegativeInt</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">i</span><span class="o">.</span><span class="nc">Get</span><span class="o">)</span> <span class="kt">list</span>
</span><span class='line'>    <span class="kt">list</span> <span class="o">=</span> <span class="n">removeNegatives</span> <span class="kt">list</span>
</span></code></pre></td></tr></table></div></figure>


<p>The Property attribute works just like the Fact in xUnit or the Test in Nunit. There is one major difference however: the function no longer takes unit, it can take any parameter that FsCheck knows how to create (and yes, you can define them yourself). NonNegativeInt is a built in alias for int which is as the name suggests is a int which is not negative.</p>

<p>You may also have noticed that there are no asserts in this test either. That is because as long as your function returns something FsCheck understands (i.e. bool, exceptions, etc), FsCheck will work out whether the test failed or not that way. So in this case, so long as the final line resolves to true, then the test will be considered to have passed.</p>

<p>There is actually one final thing to note here aswell, this test isn&rsquo;t excuted once. By default FsCheck will try to find 100 parameters that work and run the test that many times. You can change this number by setting the MaxSize like this:</p>

<figure class='code'><figcaption><span>FsCheck MaxSize</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="o">[&lt;</span><span class="nc">Property</span><span class="o">(</span><span class="nc">MaxSize</span><span class="o">=</span><span class="mi">1000</span><span class="o">)&gt;]</span>
</span><span class='line'><span class="k">let</span> <span class="o">``</span><span class="n">my</span> <span class="n">test</span><span class="o">``</span> <span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>    <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Anyway, back the tests. If you try and run this test, you&rsquo;ll see that it fails. Oh noes! What could possibly be wrong?!?! Oh yes, have you noticed that the list is actually reversed during the process, which breaks one of our properties. So lets fix that.</p>

<figure class='code'><figcaption><span>Remove Negatives Function V2</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="k">let</span> <span class="n">removeNegatives</span> <span class="kt">list</span> <span class="o">=</span>
</span><span class='line'>        <span class="k">let</span> <span class="k">rec</span> <span class="n">removeNegatives&#39;</span> <span class="kt">list</span> <span class="n">newList</span> <span class="o">=</span>
</span><span class='line'>            <span class="k">match</span> <span class="kt">list</span> <span class="k">with</span>
</span><span class='line'>            <span class="o">|</span> <span class="bp">[]</span> <span class="o">-&gt;</span> <span class="nn">List</span><span class="p">.</span><span class="n">rev</span> <span class="n">newList</span>
</span><span class='line'>            <span class="o">|</span> <span class="n">head</span> <span class="o">::</span> <span class="n">tail</span> <span class="k">when</span> <span class="n">head</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="n">removeNegatives&#39;</span> <span class="n">tail</span> <span class="n">newList</span>
</span><span class='line'>            <span class="o">|</span> <span class="n">head</span> <span class="o">::</span> <span class="n">tail</span> <span class="o">-&gt;</span> <span class="n">removeNegatives&#39;</span> <span class="n">tail</span> <span class="o">(</span><span class="n">head</span> <span class="o">::</span> <span class="n">newList</span><span class="o">)</span>
</span><span class='line'>        <span class="n">removeNegatives&#39;</span> <span class="kt">list</span> <span class="bp">[]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ok, so now we have a test covering that second property: if you pass in a non-negative list, you get the same list back again.</p>

<p>So now how about the first property, testing for the removal of elements less than zero. Well first we could write a test that checks that if you pass in a list of negative numbers, it should always return an empty list:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="o">[&lt;</span><span class="nc">Property</span><span class="o">&gt;]</span>
</span><span class='line'><span class="k">let</span> <span class="o">``</span><span class="k">for</span> <span class="n">a</span> <span class="n">negative</span> <span class="kt">list</span><span class="o">,</span> <span class="n">returns</span> <span class="n">an</span> <span class="n">empty</span> <span class="kt">list</span><span class="o">``</span> <span class="o">(</span><span class="kt">list</span><span class="o">:</span><span class="nc">PositiveInt</span> <span class="kt">list</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>    <span class="k">let</span> <span class="kt">list</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">map</span> <span class="o">(</span><span class="k">fun</span> <span class="o">(</span><span class="n">i</span><span class="o">:</span><span class="nc">PositiveInt</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">i</span><span class="o">.</span><span class="nc">Get</span><span class="o">)</span> <span class="kt">list</span>
</span><span class='line'>    <span class="bp">[]</span> <span class="o">=</span> <span class="n">removeNegatives</span> <span class="kt">list</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ok great and that passes, maybe we should write a test that tests if it actually filters things out. Well that looks something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="o">[&lt;</span><span class="nc">Property</span><span class="o">&gt;]</span>
</span><span class='line'>    <span class="k">let</span> <span class="o">``</span><span class="k">for</span> <span class="n">a</span> <span class="n">mixed</span> <span class="kt">list</span><span class="o">,</span> <span class="n">returns</span> <span class="n">a</span> <span class="n">positive</span> <span class="kt">list</span><span class="o">``</span> <span class="o">(</span><span class="kt">list</span><span class="o">:</span><span class="kt">int</span> <span class="kt">list</span><span class="o">)</span> <span class="o">=</span>
</span><span class='line'>        <span class="k">let</span> <span class="n">outputList</span> <span class="o">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">filter</span> <span class="o">(</span><span class="k">fun</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="kt">list</span>
</span><span class='line'>        <span class="n">outputList</span> <span class="o">=</span> <span class="n">removeNegatives</span> <span class="kt">list</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this case, this test rather points out the uselessness of this function. Maybe that makes it quite a bad example, but I put it here for completeness anyway (after all it does implement the same function in a single line).</p>

<h2>Side note</h2>

<p>I probably should point out that I have had some problem with using FsCheck, if you have you&rsquo;re using NCrunch you might notice the tests don&rsquo;t get picked up. However, I have found that if you include the following code in your module it works:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='fsharp'><span class='line'><span class="o">[&lt;</span><span class="nc">Fact</span><span class="o">&gt;]</span>
</span><span class='line'><span class="k">let</span> <span class="o">``</span><span class="n">ignore</span> <span class="n">this</span> <span class="n">test</span><span class="o">``</span> <span class="bp">()</span> <span class="o">=</span>
</span><span class='line'>    <span class="bp">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>This (for some reason) causes NCrunch to see all the other tests too.</p>

		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner"><p>
  Copyright &copy; 2013 - Simon Dickson -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
			

<script type="text/javascript">
      var disqus_shortname = 'simondicksonblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





		</div>
	</div>
</body>
</html>
